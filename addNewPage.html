<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>여행지 추가하기</title>
    <style>
        body {
            font-family: Arial, sans-serif;
        }
        .header {
            display: flex;
            justify-content: space-between; 
            align-items: center; 
            margin: 100px 50px 0; 
            padding: 20px; 
            background-color: #e7fcff;
        }
        .title {
            flex: 1;
            text-align: center;
        }
        
        .image-upload {
            display: inline-block; 
            width: calc(40% - 60px); 
            margin: 100px 0 0 100px; 
            vertical-align: top; 
        }
        .image-upload input[type="file"] {
            display: none;
        }
        .image-upload label {
        width: 300px; 
         height: 200px; 
         display: flex; 
          justify-content: center;
         align-items: center;
          background: url('defaultImage.png') center/cover no-repeat;
         background-size: contain; 
         cursor: pointer;
           
        }

        .image-upload p {
            text-align: center;
            margin-top: 10px;
        }
        .image-preview {
            width: 100%; /* 미리보기 이미지의 너비를 라벨 너비에 맞춤 */
          height: auto; /* 높이를 자동으로 조정하여 비율 유지 */
            display: block; /* 미리보기 이미지를 보이게 설정 */
}
        .info {
            display: inline-block;
            width: calc(50% - 100px);
            margin: 100px 0 0 130px; 
            vertical-align: top;
        }
        .info > div {
            display: flex;
            align-items: center;
            margin-bottom: 20px;
        }
        .info label, .info input[type="text"], .info .rating-box {
            width: 200px;
            text-align: center;
            line-height: 40px;
        }
        .info input[type="text"], .info .rating-box {
            margin-left: 20px;
        }
        .star-rating .star {
            cursor: pointer;
            font-size: 24px;
            display: inline-block;
        }
        .star-rating .star.selected {
            color: orange;
        }
        .extended-info {
            margin: 20px 70px;
        }
        .extended-info input[type="text"], .extended-info textarea {
            width: 100%;
            padding: 10px;
            height: 40px;
            resize: none;
        }
        .extended-info .review textarea {
            height: 300px;
            margin-top: 20px;
        }
    </style>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
</head>
<body>

<div class="header">
    <div class="title">새로운 여행지를 작성해주세요</div>
   <button id="submitBtn">완료</button>
</div>

<div class="content">
    <div class="image-upload">
        <label for="file-input" style="cursor: pointer;">
            <img id="image-preview" style="width: 100%; max-height: 200px;">
        </label>
        <input id="file-input" type="file" />
        <p>사진 추가</p>
    </div>
    <script>
        document.getElementById('file-input').addEventListener('change', function(e) {
            const file = e.target.files[0]; 
    
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    const preview = document.getElementById('image-preview');
                    preview.src = e.target.result;
                    preview.style.display = 'block'; 
                };
                reader.readAsDataURL(file); 
            }
        });
    </script>
    
    <div class="info">
        <div>
            <label for="place-name">장소명</label>
            <input type="text" id="place-name" />
        </div>
        <div>
            <label for="author">작성자</label>
            <input type="text" id="author" />
        </div>
        <div>
            <label for="phone">전화번호</label>
            <input type="text" id="phone" />
        </div>
        <div>
            <label for="hours">영업시간</label>
            <input type="text" id="hours" />
        </div>
        <label for="score">별점:</label>
        <select id="score" class="form-select">
            <option value="">별점을 선택해주세요</option>
            <option value="1">⭐️</option>
            <option value="2">⭐️⭐️</option>
            <option value="3">⭐️⭐️⭐️</option>
            <option value="4">⭐️⭐️⭐️⭐️</option>
            <option value="5">⭐️⭐️⭐️⭐️⭐️</option>
        </select>
    </div>
</div>

<div class="extended-info">
    <div>
        <label for="location">위치:</label>
        <input type="text" id="location" class="form-control" placeholder="위치를 입력해주세요" />
    </div>
    <div>
        <label for="review">후기:</label>
        <textarea id="review" class="form-control" placeholder="후기를 입력해주세요"></textarea>
    </div>
</div>
</div>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-app.js";
import { getFirestore } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore.js";
import { collection, addDoc } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore.js";
import { getDocs } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore.js";
    import { getStorage, ref as storageRef, uploadBytes, getDownloadURL } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-storage.js"; // 수정됨

    // Firebase 구성 정보 설정
    const firebaseConfig = {
      apiKey: "AIzaSyCqOAuTxvcgJn46nyyeuwN1keffqdAcgeY",
      authDomain: "spartateam9-dae30.firebaseapp.com",
      projectId: "spartateam9-dae30",
      storageBucket: "spartateam9-dae30.appspot.com",
      messagingSenderId: "86541193674",
      appId: "1:86541193674:web:d511323cd290d277073f33",
      measurementId: "G-Z2L0WZZ79B"
    };
  
    // Firebase 앱 초기화
    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);
    const storage = getStorage(app);
  
    async function uploadImageAndGetURL(file) {
      if (!file) return ""; // 파일이 없으면 빈 문자열 반환으로 처리함
      const fileRef = storageRef(storage, `images/${Date.now()}_${file.name}`);
      await uploadBytes(fileRef, file);
      return getDownloadURL(fileRef);
    }
  
    document.getElementById('submitBtn').addEventListener('click', async () => {
      const file = document.getElementById('file-input').files[0];
      const placeName = document.getElementById('place-name').value;
      const author = document.getElementById('author').value;
      const phone = document.getElementById('phone').value;
      const hours = document.getElementById('hours').value;
      const score = document.getElementById('score').value;
      const location = document.getElementById('location').value;
      const review = document.getElementById('review').value;
  
      try {
        const imageURL = await uploadImageAndGetURL(file); // 이미지 업로드 및 URL 받기
        await addDoc(collection(db, 'travels'), {
          placeName,
          imageURL, // Firestore에 이미지 URL 저장
          author,
          phone,
          hours,
          score,
          location,
          review
        });
        alert('여행지 정보가 성공적으로 추가되었습니다.');

    } catch (error) {
        console.error('Error adding document: ', error);
        alert('오류가 발생했습니다. 정보를 다시 확인해 주세요.');
      }
    });
  </script>
  